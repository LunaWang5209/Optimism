## timezone: Asia/Shanghai

#  {Cyrus}

1. 自我介绍
   四年前端目前在马来西亚读机科硕
2. 你认为你会完成本次残酷学习吗？
   可以的

## Notes

**第一周：学习 Optimism 的基本概念，包括 Layer2 扩容方案，Opimism Rollups, Tokenomics, Stage 阶段**

Layer2 扩容方案: [https://docs.optimism.io/stack/rollup/overview](https://docs.optimism.io/stack/rollup/overview)

Optimism 与其他 Layer 2 的比较：[https://learnblockchain.cn/article/3703](https://learnblockchain.cn/article/3703)

Stage 的介绍：[https://medium.com/l2beat/introducing-stages-a-framework-to-evaluate-rollups-maturity-d290bb22befe](https://medium.com/l2beat/introducing-stages-a-framework-to-evaluate-rollups-maturity-d290bb22befe)

<!-- Content_START -->

### 2025.01.06

## **MEV 的定义**

Maximal Extractable Value MEV 是利用区块链中交易排序的灵活性，来获取额外经济收益的行为。

---

### **MEV 的来源**

MEV 的主要来源是 **区块链中交易的非确定性排序** ，即矿工或验证者可以决定：

1. **哪些交易进入区块** 。
2. **交易的排序顺序** 。
3. **是否包含某些交易** 。

这种控制能力使得矿工/验证者可以通过交易排序获得经济收益。

### **MEV 的常见场景**

以下是一些典型的 MEV 操作场景：

### **1. 套利（Arbitrage）**

* **描述：**在不同去中心化交易所（如 Uniswap 和 SushiSwap）之间，价格可能存在差异，矿工可以通过调整交易顺序执行套利交易。
* **例子：**如果在 Uniswap 上 ETH 的价格是 $1000，而在 SushiSwap 上是 $1050，矿工可以优先执行套利交易，赚取差价。

---

### **2. 清算（Liquidation）**

* **描述：**在借贷协议（如 Aave、Compound）中，当借款人的抵押品价值不足时，清算者可以赚取清算奖励。矿工可以优先执行这些清算交易。
* **例子：**用户 A 的贷款被触发清算，矿工插入清算交易以获得清算奖励。

---

### **3. 三明治攻击（Sandwich Attack）**

* **描述：**这是 DeFi 中一种常见的 MEV 攻击方式，矿工通过在目标交易前后插入交易来获利。
  * **步骤：**
    1. 在目标交易之前发送一个买单，抬高价格。
    2. 等目标交易执行后，再发送一个卖单，获利。
* **结果：**目标交易者将以更高的价格完成交易，而矿工获得利润。

---

### **MEV 的影响**

### **1. 对用户的影响**

* **负面：**
  * 用户可能因为 MEV 行为（如三明治攻击）而遭受经济损失。
  * 网络拥堵时，Gas 费用可能因 MEV 的竞争而大幅上升。
* **正面：**
  * 某些 MEV 行为（如套利和清算）可以提升市场效率。

### **2. 对网络的影响**

* **安全性：**
  高额的 MEV 收益可能导致矿工/验证者之间的不公平竞争，甚至诱发攻击（如自私挖矿）。
* **去中心化：**
  MEV 的集中化可能会削弱区块链的去中心化特性。

---

### **如何缓解 MEV？**

为减少 MEV 对生态的负面影响，社区提出了多种解决方案：

### **1. Flashbots**

* **描述：**Flashbots 是一个专门用于缓解 MEV 的项目，允许用户和矿工通过专用通道提交交易，避免公开的 Gas 战争。
* **作用：**提供一个透明且高效的 MEV 提交系统，减少用户损失。

### **2. PBS（Proposer-Builder Separation）**

* **描述：**在以太坊的 PoS 机制下，将区块的提议者（Proposer）与构建者（Builder）分离，降低单一验证者的 MEV 控制力。

### **3. 去中心化排序协议**

* **描述：**使用去中心化的排序协议，确保交易顺序的公平性，例如 CowSwap 提出的公平排序机制。

## BedRock

**Bedrock** 是一种与区块链相关的术语，尤其在 Optimism 生态系统中，它特指 **Optimism Bedrock** ，即 Optimism 网络的下一代升级框架。它是一个技术更新，旨在提高网络的性能、兼容性和可扩展性，同时降低复杂性和成本。

### RollupOverview

* **Rollup 是什么**
  * **Rollup** 是区块链扩展技术中的一种解决方案，主要用于提高区块链的吞吐量（交易速度）并降低交易费用，同时保持较高的安全性。Rollup 是以太坊 Layer 2 扩展方案的核心之一，它将大部分交易计算和数据处理从主链（Layer 1）转移到次级链（Layer 2），以减少主链的负担。
* **Rollup 的原理**
  * **交易执行在 Layer 2**
    Rollup 在 Layer 2 网络中执行交易，将计算和状态存储移至链下。
  * **数据存储在 Layer 1**
    Rollup 会将交易数据或状态变更结果压缩后发布到 Layer 1（如以太坊主链）。这些数据的存在确保了 Layer 2 的安全性和透明性。
  * **主链保证安全性**
    因为 Rollup 将数据发布到 Layer 1，任何人都可以验证 Layer 2 的交易是否有效，这使得 Layer 2 网络可以继承 Layer 1 的安全性。
* **Rollup 的关键组件**
  1. **Sequencer（排序器）**
     * Rollup 网络中的核心节点，负责交易的接收、排序和打包。
     * 排序器通常是去中心化的，但在某些实现中可能由特定的运营者运行。
  2. **Fraud Proof（欺诈证明）或 Validity Proof（有效性证明）**
     * 用于验证交易是否有效。
     * Optimistic Rollup 使用 Fraud Proof
  3. **Data Availability（数据可用性）**
     * Rollup 将交易数据存储在 Layer 1，确保所有用户可以访问和验证这些数据。
* **Rollup 的优缺点**
  * **优点**
    1. **降低交易成本**
       * 大量交易计算和存储在 Layer 2 上进行，减少主链的 Gas 消耗。
    2. **提高吞吐量**
       * Rollup 每秒可以处理更多的交易，使得区块链可以支持更大的用户规模。
    3. **继承 Layer 1 的安全性**
       * 因为数据存储在 Layer 1，Layer 2 的操作受到 Layer 1 的保护。
  * **缺点**
    1. **提款延迟（Optimistic Rollup）**
       * 提款需要等待争议期，影响用户体验。
    2. **复杂性增加**
       * Rollup 的实现需要处理交易排序、数据压缩、证明生成等复杂逻辑。
* Rollup 的作用
  * **扩展区块链网络**
    * Rollup 是目前以太坊扩展的核心方案，可以帮助以太坊支持更多用户和应用。
  * **降低 DeFi 和 dApp 的成本**
    * Rollup 减少了交易成本，使 DeFi、NFT 等应用更可负担。
  * **推动区块链大规模应用**
    * Rollup 提供了更高效、更安全的交易方式，有助于推动区块链技术的主流采用。
* Optimistic Rollups 利用其母链的共识机制（如 PoW 或 PoS），而不是用自己的。
* 在“交易”包含在具有足够证明的块中之后，无法修改或审查它们。这就是OP主网继承以太坊可用性和完整性保证的方式。
* 区块的生产（OP 通过 "sequencer" ）
  * 提供交易确认和状态更新。
  * 构建并执行 L2 块。
  * 向L1提交用户交易
* 区块的执行
  * op-geth 组件实现

## 自我理解

rollup 之所以快是因为 它把交易带到的链下不消耗链上资源 然后计算完了再放到链上，而Optimistic Rollup 认为交易都是好的，只要没有纠错，就会认为数据是准确的

### 更准确的回答

### **Rollup 为什么快？**

1. **减少链上资源消耗**
   * Rollup 的核心机制是把交易的计算和存储放在链下（Layer 2）完成，而不是在主链（Layer 1）上进行。
   * 这样，主链只需要负责记录经过压缩的交易数据（数据可用性）和最终状态变更，而不需要执行每一笔交易。
   * 由于链上的操作减少了，整体交易速度（吞吐量）提升，同时 Gas 费用大幅降低。
2. **压缩和批量处理**
   * Rollup 会将多笔交易打包压缩成一个批次，批量提交到主链。
   * 这大大降低了链上的数据存储和处理成本。

---

### **Optimistic Rollup 的核心逻辑**

1. **假设交易都是正确的**

   * **“Optimistic”** 的意思是默认所有提交的交易都是有效的，只有在有人提出争议时才进行验证。
   * 这种“乐观”假设避免了每笔交易都需要实时验证，从而减少计算开销，进一步提高效率。
2. **欺诈证明（Fraud Proof）机制**

   * 为了防止无效交易或恶意操作，Optimistic Rollup 设置了一个“争议期”（通常是 7 天）。
   * 在争议期内，任何人都可以检查提交的交易数据，如果发现问题，可以提出欺诈证明。
   * 验证通过后，链会撤销无效交易并惩罚作恶者。
3. **争议期的作用**

   * 因为有争议期的存在，Optimistic Rollup 的提款操作需要等待这段时间，确保没有无效交易混入其中。

### 2025.01.07

## 核心知识

### 什么是Layer2 扩容技术？

**Layer 2 扩容技术**是为了解决区块链（尤其是以太坊）在 Layer 1（主链）上面临的**性能瓶颈和高交易成本问题**而提出的解决方案。Layer 2 的核心目标是**提高交易吞吐量、降低手续费**，同时保持主链的去中心化和安全性。

### Layer2 的基本概念

Layer 2 是**构建在主链之上的二级网络或协议**，它将大部分交易或计算移到主链之外进行处理，最后再将结果提交到主链上。这种方式减少了主链的负担，同时提高了整个系统的效率。

### 不同Layer2比较

| 扩容方案 | 适用场景 | 优点 | 缺点 | 代表项目 |
| --- | --- | --- | --- | --- |
| **状态通道** | 高频小额交易 | 低手续费，高吞吐量 | 仅适合双方交互，在线要求高 | Raiden, Lightning |
| **Plasma** | 大量简单交易 | 高扩展性，适合简单支付 | 退出机制复杂，安全依赖运营方 | OMG, Matic (早期) |
| **Optimistic Rollup** | 一般智能合约 | 简单高效，适合通用场景 | 挑战期长，提现较慢 | Optimism, Arbitrum |
| **ZK Rollup** | 高频复杂交易 | 高安全性，几乎即时提现 | 开发难度高，计算复杂 | zkSync, StarkNet |
| **Validium** | 大规模数据处理 | 超高扩展性 | 去中心化程度低 | StarkWare |

### OP 和 ZK Rollup

### **（1）Optimistic Rollup**

- **工作原理**：
    - 在主链上提交打包后的交易数据，但默认假设这些交易是有效的（“乐观”假设）。
    - 如果有人认为交易无效，可以提交“欺诈证明”（Fraud Proof），要求 Rollup 链验证交易的正确性。
    - 如果证明成功，违规的交易会被回滚，提交者将受到惩罚。
- **优点**：
    - 简单高效，吞吐量高，适合一般的智能合约。
- **缺点**：
    - 验证欺诈的挑战期较长，通常需要 1 周左右的时间。
    - 适合短期高频交易，但不适合需要快速提现的场景。

### **（2）ZK Rollup（零知识证明 Rollup）**

- **工作原理**：
    - 在主链上提交打包后的交易数据，并通过零知识证明（ZK-SNARK 或 ZK-STARK）来证明所有交易的正确性。
    - 零知识证明可以快速验证大批量交易，无需验证具体交易内容，只需验证证明是否有效。
- **优点**：
    - 验证速度快，提现时间几乎是即时的。
    - 安全性强，因为所有交易都经过数学证明，不依赖于“欺诈挑战”机制。
- **缺点**：
    - 零知识证明的生成过程计算复杂，开发难度高。

### 未来发展

- **ZK Rollup 和 Validium** 被认为是未来 Layer 2 扩容的主要方向，尤其是随着零知识证明技术的不断进步，ZK Rollup 的性能和适用范围将进一步提升。
- **Optimistic Rollup** 已经在许多项目中大规模应用，短期内仍然是最主流的方案。

## 扩展

### **Validium 与 ZK Rollup 的区别**

| **特性** | **Validium** | **ZK Rollup** |
| --- | --- | --- |
| **数据存储** | 链下存储，由数据可用性委员会维护 | 链上存储，所有数据都提交到主链 |
| **扩容能力** | 扩容能力更高，适合大规模应用 | 扩容能力有限，受限于主链存储 |
| **数据可用性保障** | 依赖数据可用性委员会 | 主链保证数据可用性 |
| **安全性** | 受数据可用性委员会诚实行为的影响 | 完全继承主链的安全性 |
| **交易成本** | 更低（由于链下数据存储减少了主链成本） | 较高（链上数据存储增加了主链成本） |
| **适用场景** | 适合对数据可用性要求较低的大规模应用 | 适合对数据可用性要求高的应用 |

### **Validium 的未来发展方向**

1. **去中心化数据可用性**
    - 当前 Validium 的主要瓶颈是数据可用性委员会的去中心化程度较低，未来可能会通过引入更多节点或新的分布式存储技术来提高去中心化程度。
2. **混合模式（Volition）**
    - 一些 Validium 项目正在开发混合模式（Volition），允许用户选择将数据存储在链上或链下，从而在扩展性和安全性之间灵活平衡。

### **什么是零知识证明（Zero-Knowledge Proof, ZKP）？**

**零知识证明**是一种密码学技术，它允许一方（证明者）向另一方（验证者）证明某个陈述是**正确的**，而**无需透露证明的具体内容**。换句话说，验证者可以确认证明者确实知道某个秘密信息，但不会获得这个信息的任何细节。

### **零知识证明的经典例子**

### **洞穴问题（Ali Baba’s Cave）**

这个经典例子经常被用来解释零知识证明的概念：

1. 想象有一个圆形的洞穴，洞穴中有一扇魔法门，只有知道某个秘密咒语的人才能打开这扇门。
2. 一个人（证明者）想向验证者证明他知道咒语，但又不想直接告诉验证者咒语是什么。
3. 洞穴有两个入口，分别是左侧和右侧。验证者站在洞外，看不到洞内情况。
4. 证明者随机选择一个入口（左或右）进入洞穴，然后验证者在洞外随机要求证明者从指定的入口走出来。
5. 如果证明者真的知道咒语，他可以打开门，从验证者指定的入口走出来；如果不知道咒语，他只能随机猜测验证者会选择哪个入口，这样他被抓到作弊的概率是 50%。

通过多次重复这个过程，验证者会逐渐确信证明者确实知道咒语，而无需直接获得咒语本

### **零知识证明的类型**

### **1. 交互式零知识证明（Interactive ZKP）**

- 在交互式零知识证明中，证明者和验证者需要多次交互，验证者通过多轮挑战来验证证明者是否知道正确信息。
- 洞穴问题是一个典型的交互式零知识证明示例。
- 缺点：需要多次交互，不适用于自动化验证和区块链场景。

### **2. 非交互式零知识证明（Non-Interactive ZKP）**

- 在非交互式零知识证明中，证明者只需要一次性提供一个证明，验证者可以通过数学方法自动验证。
- 非交互式零知识证明使用的是高级密码学技术，如 **ZK-SNARKs** 和 **ZK-STARKs**。
- 这种方式非常适合区块链中的智能合约和 Layer 2 扩容技术。

## 疑问

### 为什么会说 零知识证明开发难度高 大家都用写好的一个库不就行了

1. **涉及复杂的数学原理**，需要开发者理解高级密码学和代数知识。
2. **电路设计复杂**，需要手动将逻辑转化为加法门和乘法门形式，且电路的调试不直观。
3. **性能优化困难**，不同场景需要不同的零知识证明算法，并且库的默认实现未必是最优的。
4. **信任设置和兼容性问题**，对于 zk-SNARK，需要处理可信设置问题，对于 zk-STARK，则需要优化证明大小和生成速度。
5. **库的使用门槛高**，虽然现有库降低了入门难度，但如何正确、高效地使用这些库仍然是一个挑战。

**现状：正在变得简单**

随着零知识证明技术的普及，生态系统正在不断完善，新工具和框架也在降低开发难度。例如：

- **Circom** 和 **snarkjs** 提供了较为成熟的 zk-SNARK 电路编写工具。
- **zkSync** 和 **StarkNet** 等项目提供了高度集成的 Layer 2 解决方案，开发者可以直接使用，而不需要手动构建 zk 电路。
- **Halo2** 和 **Plonky2** 等新型证明系统降低了零知识证明的开发和验证成本。

<!-- Content_END -->
